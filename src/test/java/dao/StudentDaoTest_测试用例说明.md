# StudentDaoImpl 单元测试用例说明

## 测试类信息
- **测试类名**: `StudentDaoTest`
- **被测试类**: `StudentDaoImpl`
- **测试文件路径**: `src/test/java/dao/StudentDaoTest.java`
- **测试用例总数**: 17个
- **创建日期**: 2025-12-15

## 测试环境
- **测试数据库**: counselor_student_system
- **测试数据标识**: 
  - `TEST001` - 测试学生1（虚拟测试数据）
  - `TEST002` - 测试学生2（虚拟测试数据）
  - `TEST999` - 不存在的学号（用于边界测试）
- **测试专业编号**: 8329（计算机科学与技术，从data.sql中获取）
- **测试年级编号**: 2023（从data.sql中获取）
- **测试班级编号**: 1（从data.sql中获取）
- **测试密码**: test123
- **错误密码**: wrong123

## 用例编号说明
- **编号格式**: TC + 三位数字
- **TC含义**: Test Case（测试用例）
- **编号范围**: TC001 - TC017

## 测试用例清单

### 1. getStudentByIdAndPassword 方法测试

#### 用例 TC001: 测试根据学号和密码查询学生 - 正确凭据
- **测试方法**: `testGetStudentByIdAndPassword_Success()`
- **测试类型**: 正常情况测试
- **前置条件**: 
  - 数据库中存在学号为 TEST001 的学生（由@BeforeEach自动创建）
  - 该学生的密码为 "test123"
- **测试步骤**:
  1. 调用 `getStudentByIdAndPassword("TEST001", "test123")`
  2. 验证返回的Student对象不为null
  3. 验证学号字段匹配（assertEquals TEST_STUDENT_ID）
  4. 验证姓名字段匹配（assertEquals "测试学生1"）
  5. 验证密码字段匹配（assertEquals TEST_PASSWORD）
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 学号 | TEST001 | 虚拟测试学号 |
| 密码 | test123 | 测试密码 |

- **预期结果**: 
  - 返回Student对象（不为null）
  - studentId = "TEST001"
  - name = "测试学生1"
  - password = "test123"
- **实际结果**: ✅ 通过
- **备注**: 验证正常登录场景，使用虚拟测试数据

#### 用例 TC002: 测试根据学号和密码查询学生 - 错误密码
- **测试方法**: `testGetStudentByIdAndPassword_WrongPassword()`
- **测试类型**: 异常情况测试
- **前置条件**: 
  - 数据库中存在学号为 TEST001 的学生
  - 该学生的密码为 "test123"
- **测试步骤**:
  1. 调用 `getStudentByIdAndPassword("TEST001", "wrong123")`
  2. 验证返回值为null
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 学号 | TEST001 | 虚拟测试学号（正确） |
| 密码 | wrong123 | 错误密码 |

- **预期结果**: 返回null（密码错误）
- **实际结果**: ✅ 通过
- **备注**: 验证密码验证功能

#### 用例 TC003: 测试根据学号和密码查询学生 - 不存在的学号
- **测试方法**: `testGetStudentByIdAndPassword_NotExist()`
- **测试类型**: 边界情况测试
- **前置条件**: 数据库中不存在学号为 TEST999 的学生
- **测试步骤**:
  1. 调用 `getStudentByIdAndPassword("TEST999", "test123")`
  2. 验证返回值为null
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 学号 | TEST999 | 不存在的虚拟测试学号 |
| 密码 | test123 | 任意密码 |

- **预期结果**: 返回null（学号不存在）
- **实际结果**: ✅ 通过
- **备注**: 验证不存在的用户处理

### 2. getStudentById 方法测试

#### 用例 TC004: 测试根据学号查询学生 - 存在的学生
- **测试方法**: `testGetStudentById_Exists()`
- **测试类型**: 正常情况测试
- **前置条件**: 数据库中存在学号为 TEST001 的学生
- **测试步骤**:
  1. 调用 `getStudentById("TEST001")`
  2. 验证返回的Student对象不为null
  3. 验证学号字段匹配
  4. 验证姓名字段匹配
  5. 验证专业编号字段匹配（assertEquals TEST_MAJOR_ID）
  6. 验证年级编号字段匹配（assertEquals TEST_GRADE_NUMBER）
  7. 验证班级编号字段匹配（assertEquals TEST_CLASS_ID）
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 学号 | TEST001 | 虚拟测试学号 |

- **预期结果**: 
  - 返回Student对象（不为null）
  - 所有字段与数据库记录一致
  - studentId = "TEST001"
  - name = "测试学生1"
  - majorId = "8329"
  - gradeNumber = "2023"
  - classId = "1"
- **实际结果**: ✅ 通过
- **备注**: 验证基本查询功能

#### 用例 TC005: 测试根据学号查询学生 - 不存在的学生
- **测试方法**: `testGetStudentById_NotExists()`
- **测试类型**: 边界情况测试
- **前置条件**: 数据库中不存在学号为 TEST999 的学生
- **测试步骤**:
  1. 调用 `getStudentById("TEST999")`
  2. 验证返回值为null
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 学号 | TEST999 | 不存在的虚拟测试学号 |

- **预期结果**: 返回null
- **实际结果**: ✅ 通过
- **备注**: 验证不存在记录的处理

#### 用例 TC006: 测试根据学号查询学生 - 空字符串
- **测试方法**: `testGetStudentById_EmptyString()`
- **测试类型**: 边界情况测试
- **前置条件**: 无
- **测试步骤**:
  1. 调用 `getStudentById("")`
  2. 验证返回值为null
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 学号 | "" | 空字符串 |

- **预期结果**: 返回null（空字符串查询不到记录）
- **实际结果**: ✅ 通过
- **备注**: 验证空字符串输入处理

### 3. addStudent 方法测试

#### 用例 TC007: 测试添加学生 - 正常情况
- **测试方法**: `testAddStudent_Success()`
- **测试类型**: 正常情况测试
- **前置条件**: 
  - 数据库中不存在学号为 TEST002 的学生
  - 存在专业编号8329、年级2023、班级1的班级记录
- **测试步骤**:
  1. 创建新的Student对象
  2. 设置学号为TEST002
  3. 设置专业编号为8329
  4. 设置年级编号为2023
  5. 设置班级编号为1
  6. 设置姓名为"测试学生2"
  7. 设置性别为"女"
  8. 设置出生日期为2001-05-15
  9. 设置手机号码为"13900000000"
  10. 设置密码为"password123"
  11. 调用 `addStudent(newStudent)`
  12. 验证返回值为true
  13. 调用 `getStudentById("TEST002")` 验证学生已添加
  14. 验证学生信息与输入一致
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 学号 | TEST002 | 虚拟测试学号 |
| 专业编号 | 8329 | 计算机科学与技术 |
| 年级编号 | 2023 | 2023级 |
| 班级编号 | 1 | 1班 |
| 姓名 | 测试学生2 | 测试姓名 |
| 性别 | 女 | 性别 |
| 出生日期 | 2001-05-15 | 日期 |
| 手机号码 | 13900000000 | 手机号 |
| 密码 | password123 | 密码 |

- **预期结果**: 
  - addStudent返回true
  - 可以查询到新添加的学生
  - 学生信息与输入一致
- **实际结果**: ✅ 通过
- **备注**: 验证数据插入功能

#### 用例 TC008: 测试添加学生 - 重复学号
- **测试方法**: `testAddStudent_DuplicateId()`
- **测试类型**: 异常情况测试
- **前置条件**: 数据库中已存在学号为 TEST001 的学生
- **测试步骤**:
  1. 创建Student对象
  2. 设置学号为TEST001（重复）
  3. 设置其他必要字段
  4. 调用 `addStudent(duplicateStudent)`
  5. 验证抛出SQLException异常
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 学号 | TEST001 | 已存在的虚拟测试学号（重复） |
| 专业编号 | 8329 | 计算机科学与技术 |
| 年级编号 | 2023 | 2023级 |
| 班级编号 | 1 | 1班 |
| 姓名 | 重复学生 | 测试姓名 |
| 密码 | password123 | 密码 |

- **预期结果**: 抛出SQLException（违反主键约束）
- **实际结果**: ✅ 通过
- **备注**: 验证主键约束检查

### 4. updateStudent 方法测试

#### 用例 TC009: 测试更新学生信息 - 正常情况
- **测试方法**: `testUpdateStudent_Success()`
- **测试类型**: 正常情况测试
- **前置条件**: 数据库中存在学号为 TEST001 的学生
- **测试步骤**:
  1. 调用 `getStudentById("TEST001")` 查询现有学生信息
  2. 验证学生存在（不为null）
  3. 修改学生姓名、手机号码、性别
  4. 调用 `updateStudent(student)`
  5. 验证返回值为true
  6. 调用 `getStudentById("TEST001")` 重新查询
  7. 验证信息已更新
- **输入数据**:

| 字段名 | 原始值 | 更新值 | 说明 |
|--------|--------|--------|------|
| 学号 | TEST001 | TEST001 | 不变 |
| 姓名 | 测试学生1 | 更新后的姓名 | 已更新 |
| 手机号码 | 13800000000 | 13999999999 | 已更新 |
| 性别 | 男 | 女 | 已更新 |

- **预期结果**: 
  - updateStudent返回true
  - 查询到的学生信息已更新
  - 姓名 = "更新后的姓名"
  - 手机号码 = "13999999999"
  - 性别 = "女"
- **实际结果**: ✅ 通过
- **备注**: 验证数据更新功能

#### 用例 TC010: 测试更新学生信息 - 不存在的学生
- **测试方法**: `testUpdateStudent_NotExists()`
- **测试类型**: 边界情况测试
- **前置条件**: 数据库中不存在学号为 TEST999 的学生
- **测试步骤**:
  1. 创建Student对象
  2. 设置学号为TEST999
  3. 设置其他必要字段
  4. 调用 `updateStudent(nonExistentStudent)`
  5. 验证返回值为false
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 学号 | TEST999 | 不存在的虚拟测试学号 |
| 专业编号 | 8329 | 计算机科学与技术 |
| 年级编号 | 2023 | 2023级 |
| 班级编号 | 1 | 1班 |
| 姓名 | 不存在的学生 | 测试姓名 |
| 密码 | password123 | 密码 |

- **预期结果**: 返回false（没有记录被更新）
- **实际结果**: ✅ 通过
- **备注**: 验证不存在记录的处理

### 5. deleteStudent 方法测试

#### 用例 TC011: 测试删除学生 - 正常情况
- **测试方法**: `testDeleteStudent_Success()`
- **测试类型**: 正常情况测试
- **前置条件**: 数据库中存在学号为 TEST001 的学生
- **测试步骤**:
  1. 调用 `getStudentById("TEST001")` 验证学生存在
  2. 调用 `deleteStudent("TEST001")`
  3. 验证返回值为true
  4. 调用 `getStudentById("TEST001")` 再次查询
  5. 验证返回值为null（学生已被删除）
  6. 重新插入学生以便@AfterEach清理
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 学号 | TEST001 | 虚拟测试学号 |

- **预期结果**: 
  - deleteStudent返回true
  - 查询不到该学生（返回null）
- **实际结果**: ✅ 通过
- **备注**: 验证数据删除功能

#### 用例 TC012: 测试删除学生 - 不存在的学生
- **测试方法**: `testDeleteStudent_NotExists()`
- **测试类型**: 边界情况测试
- **前置条件**: 数据库中不存在学号为 TEST999 的学生
- **测试步骤**:
  1. 调用 `deleteStudent("TEST999")`
  2. 验证返回值为false
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 学号 | TEST999 | 不存在的虚拟测试学号 |

- **预期结果**: 返回false（没有记录被删除）
- **实际结果**: ✅ 通过
- **备注**: 验证不存在记录的处理

#### 用例 TC013: 测试删除学生 - 空字符串
- **测试方法**: `testDeleteStudent_EmptyString()`
- **测试类型**: 边界情况测试
- **前置条件**: 无
- **测试步骤**:
  1. 调用 `deleteStudent("")`
  2. 验证返回值为false
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 学号 | "" | 空字符串 |

- **预期结果**: 返回false（空字符串查询不到记录）
- **实际结果**: ✅ 通过
- **备注**: 验证空字符串输入处理

### 6. getStudentCountByClassId 方法测试

#### 用例 TC014: 测试根据班级编号统计学生人数 - 有学生的班级
- **测试方法**: `testGetStudentCountByClassId_WithStudents()`
- **测试类型**: 正常情况测试
- **前置条件**: 
  - 班级编号1的班级存在
  - 该班级至少有一个学生（测试学生TEST001）
- **测试步骤**:
  1. 调用 `getStudentCountByClassId("1")`
  2. 验证返回值 >= 1
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 班级编号 | 1 | 测试班级编号 |

- **预期结果**: 返回 >= 1（至少包含测试学生）
- **实际结果**: ✅ 通过
- **备注**: 验证统计功能

#### 用例 TC015: 测试根据班级编号统计学生人数 - 空班级
- **测试方法**: `testGetStudentCountByClassId_EmptyClass()`
- **测试类型**: 边界情况测试
- **前置条件**: 班级编号999的班级不存在或没有学生
- **测试步骤**:
  1. 调用 `getStudentCountByClassId("999")`
  2. 验证返回值为0
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 班级编号 | 999 | 不存在的班级编号 |

- **预期结果**: 返回0
- **实际结果**: ✅ 通过
- **备注**: 验证空班级统计

#### 用例 TC016: 测试根据班级编号统计学生人数 - 空字符串
- **测试方法**: `testGetStudentCountByClassId_EmptyString()`
- **测试类型**: 边界情况测试
- **前置条件**: 无
- **测试步骤**:
  1. 调用 `getStudentCountByClassId("")`
  2. 验证返回值为0
- **输入数据**:

| 字段名 | 字段值 | 说明 |
|--------|--------|------|
| 班级编号 | "" | 空字符串 |

- **预期结果**: 返回0（空字符串查询不到记录）
- **实际结果**: ✅ 通过
- **备注**: 验证空字符串输入处理

### 7. 测试环境验证

#### 用例 TC017: 测试数据库连接 - 验证测试环境
- **测试方法**: `testDatabaseConnection()`
- **测试类型**: 环境验证测试
- **前置条件**: 数据库服务正在运行
- **测试步骤**:
  1. 调用 `DatabaseConnection.getConnection()`
  2. 验证连接对象不为null
  3. 验证连接未关闭（isClosed()返回false）
  4. 关闭连接
- **输入数据**: 无（环境验证）
- **预期结果**: 
  - 连接对象不为null
  - 连接状态为打开（isClosed() = false）
- **实际结果**: ✅ 通过
- **备注**: 验证测试环境配置正确

## 测试覆盖率

- **方法覆盖率**: 100% (6/6个公共方法)
- **行覆盖率**: 待使用IDEA Coverage工具查看
- **分支覆盖率**: 待使用IDEA Coverage工具查看

## 测试总结

### 测试结果统计
- **总测试用例数**: 17
- **通过**: 17
- **失败**: 0
- **错误**: 0
- **跳过**: 0
- **通过率**: 100%

### 测试覆盖场景
- ✅ **正常情况测试**: 7个用例（TC001, TC004, TC007, TC009, TC011, TC014, TC017）
- ✅ **边界情况测试**: 7个用例（TC003, TC005, TC006, TC010, TC012, TC013, TC015, TC016）
- ✅ **异常情况测试**: 2个用例（TC002, TC008）
- ✅ **环境验证测试**: 1个用例（TC017）

### 测试方法覆盖
- ✅ `getStudentByIdAndPassword`: 3个测试用例（TC001-TC003）
- ✅ `getStudentById`: 3个测试用例（TC004-TC006）
- ✅ `addStudent`: 2个测试用例（TC007-TC008）
- ✅ `updateStudent`: 2个测试用例（TC009-TC010）
- ✅ `deleteStudent`: 3个测试用例（TC011-TC013）
- ✅ `getStudentCountByClassId`: 3个测试用例（TC014-TC016）
- ✅ `testDatabaseConnection`: 1个测试用例（TC017）

### 发现的问题
- 无

### 改进建议
- 无

## 附录

### 测试数据说明
- **TEST001**: 测试学生1，用于大部分测试用例（由@BeforeEach自动创建）
- **TEST002**: 测试学生2，用于添加测试（由测试用例创建，@AfterEach清理）
- **TEST999**: 不存在的学号，用于边界测试

### 测试数据清理
- 所有测试数据在 `@AfterEach` 方法中自动清理
- 使用唯一标识（TEST前缀）避免与真实数据冲突
- 测试方法独立，不依赖执行顺序

### 真实数据参考
虽然本测试使用虚拟数据，但可以参考数据库中的真实数据格式：

| 字段名 | 真实数据示例 | 说明 |
|--------|------------|------|
| 学号 | 202383290001 | 2023级计算机科学与技术专业学生 |
| 密码 | 123456 | 默认密码 |
| 姓名 | 张三 | 学生姓名 |
| 专业编号 | 8329 | 计算机科学与技术 |
| 年级编号 | 2023 | 2023级 |
| 班级编号 | 1 | 1班 |

**注意**: 本测试使用虚拟数据（TEST001等）而非真实数据，以确保测试独立性和可重复性。

